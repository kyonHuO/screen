<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è£½å“æ¯”è¼ƒãƒ„ãƒ¼ãƒ«</title>

  <!-- Tailwind CDNï¼ˆé–‹ç™ºæ™‚ãªã‚‰ã“ã‚Œã§ OKã€‚æœ€çµ‚çš„ã«ã¯ PurgeCSS ã§è»½é‡åŒ–æ¨å¥¨ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Markdownãƒ‘ãƒ¼ã‚µï¼ˆGemini ã®å›ç­”ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã¨ãç”¨ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* --- å¿…è¦æœ€ä½é™ã®ã‚«ã‚¹ã‚¿ãƒ  CSSã€‚è©³ç´°ã¯å‰å›ã¨åŒã˜ --- */
    body { font-family: 'Noto Sans JP', sans-serif; background:#f8f9fa; }
    .card{background:#fff;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.08);transition:.3s;}
    .card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.1);}
    .btn{border-radius:8px;font-weight:500;transition:.2s;}
    .btn-primary{background:#3b82f6;color:#fff}.btn-primary:hover{background:#2563eb}
    .btn-secondary{background:#6b7280;color:#fff}.btn-secondary:hover{background:#4b5563}
    .btn-tertiary{background:#10b981;color:#fff}.btn-tertiary:hover{background:#059669}
    .btn-danger{background:#ef4444;color:#fff}.btn-danger:hover{background:#dc2626}
    ::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-thumb{background:#a8a8a8;border-radius:4px}
  </style>
</head>
<body class="antialiased text-gray-800">
  <!-- ========== â‘  è£½å“ã‚«ãƒ†ã‚´ãƒªé¸æŠç”»é¢ ========== -->
  <div id="selection-screen" class="flex flex-col items-center justify-center min-h-screen p-6">
    <h1 class="text-4xl font-bold mb-6">è£½å“æ¯”è¼ƒãƒ„ãƒ¼ãƒ«</h1>
    <p class="mb-10 text-gray-600">æ¯”è¼ƒã—ãŸã„è£½å“ã‚«ãƒ†ã‚´ãƒªã‚’é¸ã‚“ã§ãã ã•ã„</p>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 w-full max-w-4xl">
      <button id="select-tv" class="card p-8 text-center hover:shadow-lg">
        <div class="text-5xl mb-4">ğŸ“º</div><span class="text-xl font-semibold">ãƒ†ãƒ¬ãƒ“</span>
      </button>
      <button id="select-ac" class="card p-8 text-center hover:shadow-lg">
        <div class="text-5xl mb-4">ğŸ’¨</div><span class="text-xl font-semibold">ã‚¨ã‚¢ã‚³ãƒ³</span>
      </button>
      <button id="select-refrigerator" class="card p-8 text-center hover:shadow-lg">
        <div class="text-5xl mb-4">ğŸ§Š</div><span class="text-xl font-semibold">å†·è”µåº«</span>
      </button>
    </div>
  </div>

  <!-- ========== â‘¡ ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªç”»é¢ï¼ˆåˆæœŸã¯ hiddenï¼‰ ========== -->
  <div id="app-container" class="hidden container mx-auto p-6">
    <!-- ã‚¿ã‚¤ãƒˆãƒ« & æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
    <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
      <button id="back-to-selection" class="btn bg-gray-200 text-gray-700 px-3 py-1">&larr; æˆ»ã‚‹</button>
      <div>
        <h2 id="main-title" class="text-2xl font-bold"></h2>
        <p id="main-subtitle" class="text-gray-500"></p>
      </div>
    </header>

    <!-- ãƒ•ã‚£ãƒ«ã‚¿ â†’ ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ â†’ æ¯”è¼ƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè©³ç´°ã¯å¾Œè¿° JS ãŒæŒ¿å…¥ï¼‰ -->
    <div id="filter-container" class="space-y-6 mb-8"></div>
    <h3 id="model-list-title" class="text-xl font-bold mb-4"></h3>
    <div id="model-list" class="grid gap-6"></div>
    <div id="comparison-preview" class="my-8"></div>
  </div>

  <!-- ========== â‘¢ å„ç¨®ãƒ¢ãƒ¼ãƒ€ãƒ« (è©³ç´°è¡¨ç¤ºã‚„æ¯”è¼ƒè¡¨ãªã©) ========== -->
  <div id="modal-root"></div>

  <!-- ========== â‘£ ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ========== -->
  <script>
    /* ----------------------------------------------------------------
       A. ã“ã“ã§ã€Œã‚«ãƒ†ã‚´ãƒªã”ã¨ã®è¨­å®šã€ã¨ã€ŒJSONãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã€ã‚’å®šç¾©
    ---------------------------------------------------------------- */
    const productConfigs = {
      tv: {
        title: "ãƒ†ãƒ¬ãƒ“å‹ç•ªæ¯”è¼ƒãƒ„ãƒ¼ãƒ«",
        subtitle: "æ°—ã«ãªã‚‹ãƒ†ãƒ¬ãƒ“ã‚’é¸æŠã—ã¦æ€§èƒ½ã‚’æ¯”è¼ƒã—ã¾ã—ã‚‡ã†ã€‚",
        dataUrl: "tv-data.json",          // â† JSON ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ‘ã‚¹
        modelNameKey: "ãƒ¢ãƒ‡ãƒ«å",
        cardFields: [
          { label: "ã‚µã‚¤ã‚º", key: "ã‚µã‚¤ã‚º(ã‚¤ãƒ³ãƒ)", suffix: "ã‚¤ãƒ³ãƒ" },
          { label: "è§£åƒåº¦", key: "è§£åƒåº¦" },
          { label: "ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥", key: "ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ¬ãƒ¼ãƒˆ" }
        ],
        filters: [
          { key: "ãƒ¡ãƒ¼ã‚«ãƒ¼", label: "ãƒ¡ãƒ¼ã‚«ãƒ¼ã§çµã‚Šè¾¼ã¿" },
          { key: "ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æŠ€è¡“", label: "ãƒ‘ãƒãƒ«ç¨®åˆ¥" }
        ]
      },
      ac: {
        title: "ã‚¨ã‚¢ã‚³ãƒ³å‹ç•ªæ¯”è¼ƒãƒ„ãƒ¼ãƒ«",
        subtitle: "æ°—ã«ãªã‚‹ã‚¨ã‚¢ã‚³ãƒ³ã‚’é¸æŠã—ã¦æ€§èƒ½ã‚’æ¯”è¼ƒã—ã¾ã—ã‚‡ã†ã€‚",
        dataUrl: "ac-data.json",
        modelNameKey: "å‹ç•ª",
        cardFields: [
          { label: "ç•³æ•°", key: "ç•³æ•°" },
          { label: "çœã‚¨ãƒæ€§èƒ½", key: "çœã‚¨ãƒæ€§èƒ½" },
          { label: "å†·æš–æˆ¿èƒ½åŠ›", key: "å†·æš–æˆ¿èƒ½åŠ›" }
        ],
        filters: [
          { key: "ãƒ¡ãƒ¼ã‚«ãƒ¼", label: "ãƒ¡ãƒ¼ã‚«ãƒ¼ã§çµã‚Šè¾¼ã¿" },
          { key: "ç•³æ•°", label: "é©ç”¨ç•³æ•°" }
        ]
      },
      refrigerator: {
        title: "å†·è”µåº«å‹ç•ªæ¯”è¼ƒãƒ„ãƒ¼ãƒ«",
        subtitle: "æ°—ã«ãªã‚‹å†·è”µåº«ã‚’é¸æŠã—ã¦æ€§èƒ½ã‚’æ¯”è¼ƒã—ã¾ã—ã‚‡ã†ã€‚",
        dataUrl: "refrigerator-data.json",
        modelNameKey: "å‹ç•ª",
        cardFields: [
          { label: "å®¹é‡", key: "å®šæ ¼å†…å®¹ç©(L)", suffix: "L" },
          { label: "çœã‚¨ãƒé”æˆç‡", key: "çœã‚¨ãƒåŸºæº–é”æˆç‡(%)", suffix: "%" },
          { label: "ãƒ‰ã‚¢", key: "ãƒ‰ã‚¢ã‚¿ã‚¤ãƒ—" }
        ],
        filters: [
          { key: "ãƒ¡ãƒ¼ã‚«ãƒ¼", label: "ãƒ¡ãƒ¼ã‚«ãƒ¼ã§çµã‚Šè¾¼ã¿" },
          { key: "å®šæ ¼å†…å®¹ç©(L)", label: "å®¹é‡å¸¯" }
        ]
      }
    };

    /* ----------------------------------------------------------------
       B. ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã‚’æŒã¤ã‚·ãƒ³ãƒ—ãƒ«ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    ---------------------------------------------------------------- */
    const appState = {
      productType: null,
      data: [],
      selected: [],
      filters: {}
    };

    /* ----------------------------------------------------------------
       C. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    ---------------------------------------------------------------- */
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);
    const sanitizeId = (str) => str.replace(/\s+/g,'_').replace(/[^\w-]/g,'');

    /* ----------------------------------------------------------------
       D. ç”»é¢é·ç§»ç³»
    ---------------------------------------------------------------- */
    function showSelection() {
      $("#selection-screen").classList.remove("hidden");
      $("#app-container").classList.add("hidden");
    }
    function showApp() {
      $("#selection-screen").classList.add("hidden");
      $("#app-container").classList.remove("hidden");
    }

    /* ----------------------------------------------------------------
       E. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ & ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    ---------------------------------------------------------------- */
    async function launchApp(type) {
      appState.productType = type;
      appState.selected = [];
      appState.filters = {};

      const cfg = productConfigs[type];
      $("#main-title").textContent = cfg.title;
      $("#main-subtitle").textContent = cfg.subtitle;

      // JSON ã‚’å–å¾—
      appState.data = await fetch(cfg.dataUrl).then(r => r.json());

      renderFilters();
      renderModelList();
      showApp();
    }

    function renderFilters() {
      const cfg = productConfigs[appState.productType];
      const container = $("#filter-container");
      container.innerHTML = "";
      cfg.filters.forEach(f => {
        const values = [...new Set(appState.data.map(d => d[f.key]).filter(Boolean))].sort();
        const section = document.createElement("div");
        section.innerHTML = `<h4 class="font-bold mb-2">${f.label}</h4>`;
        const btnWrap = document.createElement("div");
        btnWrap.className = "flex flex-wrap gap-2";
        // ã€Œã™ã¹ã¦ã€ãƒœã‚¿ãƒ³
        btnWrap.appendChild(makeFilterBtn(f.key, "ã™ã¹ã¦", null));
        values.forEach(v => btnWrap.appendChild(makeFilterBtn(f.key, v, v)));
        section.appendChild(btnWrap);
        container.appendChild(section);
      });
    }
    function makeFilterBtn(key, label, value) {
      const btn = document.createElement("button");
      btn.textContent = label;
      btn.className = "btn bg-gray-200 text-gray-700 px-3 py-1 text-sm";
      if (appState.filters[key] === value || (value===null && !(key in appState.filters))) {
        btn.classList.add("btn-primary","text-white");
      }
      btn.onclick = () => {
        if (value === null) delete appState.filters[key];
        else appState.filters[key] = value;
        renderFilters();
        renderModelList();
      };
      return btn;
    }

    function renderModelList() {
      const cfg = productConfigs[appState.productType];
      const wrap = $("#model-list");
      wrap.className = "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6";
      let list = [...appState.data];

      // ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨
      Object.entries(appState.filters).forEach(([k,v]) => {
        list = list.filter(d => d[k] === v);
      });

      // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
      wrap.innerHTML = list.map(item => {
        const selected = appState.selected.includes(item);
        return `
          <div class="card p-5 ${selected?'ring-2 ring-blue-400':''}" data-id="${sanitizeId(item[cfg.modelNameKey])}">
            <h3 class="text-lg font-bold mb-2">${item["ãƒ¡ãƒ¼ã‚«ãƒ¼"]} ${item[cfg.modelNameKey]}</h3>
            ${cfg.cardFields.map(f => `
              <p class="text-sm"><strong>${f.label}:</strong> ${item[f.key]||'â€”'}${f.suffix||''}</p>
            `).join("")}
            <button class="btn ${selected?'btn-secondary':'btn-primary'} text-xs px-3 py-1 mt-4 select-btn">
              ${selected?'é¸æŠè§£é™¤':'é¸æŠ'}
            </button>
          </div>`;
      }).join("");

      // ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆä»˜ä¸
      $$("#model-list .select-btn").forEach(btn => {
        btn.onclick = (e) => {
          const card = e.target.closest(".card");
          const id = card.dataset.id;
          const model = list.find(d => sanitizeId(d[cfg.modelNameKey]) === id);
          const idx = appState.selected.indexOf(model);
          if (idx>-1) appState.selected.splice(idx,1); else appState.selected.push(model);
          renderModelList();
          renderComparisonPreview();
        };
      });
      renderComparisonPreview();
    }

    function renderComparisonPreview() {
      const wrap = $("#comparison-preview");
      const sel = appState.selected;
      if (!sel.length) { wrap.innerHTML = ""; return; }
      wrap.innerHTML = `
        <h4 class="font-bold mb-2">æ¯”è¼ƒä¸­ (${sel.length})</h4>
        <div class="flex flex-wrap gap-2 mb-3">
          ${sel.map(m => `<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${m["ãƒ¡ãƒ¼ã‚«ãƒ¼"]} ${m[productConfigs[appState.productType].modelNameKey]}</span>`).join("")}
        </div>
        <button class="btn btn-primary text-sm px-4 py-1" id="compare-btn">æ¯”è¼ƒè¡¨ã‚’è¡¨ç¤º</button>
      `;
      $("#compare-btn")?.addEventListener("click", showComparisonModal);
    }

    function showComparisonModal() {
      const cfg = productConfigs[appState.productType];
      const sel = appState.selected;
      const headers = Object.keys(sel[0]);
      let html = `
        <div class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50" id="cmp-modal">
          <div class="bg-white rounded-lg shadow-xl max-w-full max-h-full overflow-auto p-6">
            <button class="text-2xl mb-4" id="cmp-close">&times;</button>
            <table class="border-collapse text-sm">
              <thead><tr><th class="border p-2 bg-gray-100">é …ç›®</th>${sel.map(m=>`<th class="border p-2 bg-gray-100">${m["ãƒ¡ãƒ¼ã‚«ãƒ¼"]}<br>${m[cfg.modelNameKey]}</th>`).join("")}</tr></thead>
              <tbody>
              ${headers.filter(h=>h!=="id").map(h=>`
                <tr>
                  <td class="border p-2 font-bold bg-gray-50">${h}</td>
                  ${sel.map(m=>`<td class="border p-2">${m[h]||'â€”'}</td>`).join("")}
                </tr>
              `).join("")}
              </tbody>
            </table>
          </div>
        </div>`;
      $("#modal-root").innerHTML = html;
      $("#cmp-close").onclick = () => $("#cmp-modal").remove();
    }

    /* ----------------------------------------------------------------
       F. ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
    ---------------------------------------------------------------- */
    $("#select-tv").onclick = () => launchApp("tv");
    $("#select-ac").onclick = () => launchApp("ac");
    $("#select-refrigerator").onclick = () => launchApp("refrigerator");
    $("#back-to-selection").onclick = showSelection;
  </script>
</body>
</html>
