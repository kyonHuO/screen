<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S.L.O.T.H. â€“ è£½å“æ¯”è¼ƒãƒ„ãƒ¼ãƒ«</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    body{font-family:'Noto Sans JP',sans-serif;background:#f8f9fa}
    .card{background:#fff;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.08);transition:.3s;cursor:pointer}
    .card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.1)}
    .btn{border-radius:8px;font-weight:500;transition:.2s}
    .btn-primary{background:#3b82f6;color:#fff}.btn-primary:hover{background:#2563eb}
    .btn-secondary{background:#6b7280;color:#fff}.btn-secondary:hover{background:#4b5563}
    .btn-tertiary{background:#10b981;color:#fff}.btn-tertiary:hover{background:#059669}
    .btn-danger{background:#ef4444;color:#fff}.btn-danger:hover{background:#dc2626}
    ::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-thumb{background:#a8a8a8;border-radius:4px}
  </style>
</head>
<body class="antialiased text-gray-800">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="py-4 text-center bg-white shadow fixed top-0 w-full z-40 select-none">
    <h1 class="text-3xl font-extrabold tracking-widest text-blue-700">S.L.O.T.H.</h1>
    <p class="text-xs text-gray-500 mt-1">System&nbsp;Lazily&nbsp;Optimized&nbsp;to&nbsp;Help</p>
  </header>

  <!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠ -->
  <div id="selection-screen" class="flex flex-col items-center justify-center min-h-screen pt-32 p-6 text-center">
    <h2 class="text-4xl font-extrabold text-blue-700 mb-1">S.L.O.T.H.</h2>
    <p class="text-sm text-gray-500 mb-8">System Lazily Optimized to Help</p>
    <p class="mb-10 text-gray-600">æ¯”è¼ƒã—ãŸã„ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</p>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 w-full max-w-4xl">
      <div id="select-tv" class="card p-8">
        <div class="text-5xl mb-4" aria-hidden="true">ğŸ“º</div><span class="text-xl font-semibold">ãƒ†ãƒ¬ãƒ“</span>
      </div>
      <div id="select-ac" class="card p-8">
        <div class="text-5xl mb-4" aria-hidden="true">ğŸ’¨</div><span class="text-xl font-semibold">ã‚¨ã‚¢ã‚³ãƒ³</span>
      </div>
      <div id="select-refrigerator" class="card p-8">
        <div class="text-5xl mb-4" aria-hidden="true">ğŸ§Š</div><span class="text-xl font-semibold">å†·è”µåº«</span>
      </div>
    </div>
  </div>

  <!-- ã‚¢ãƒ—ãƒªæœ¬ä½“ -->
  <div id="app-container" class="hidden container mx-auto p-6 pt-32">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
      <button id="back-to-selection" class="btn bg-gray-200 text-gray-700 px-3 py-1">&larr; æˆ»ã‚‹</button>
      <div>
        <h2 id="main-title" class="text-2xl font-bold"></h2>
        <p id="main-subtitle" class="text-gray-500 text-sm"></p>
      </div>
      <div class="flex items-center gap-3">
        <label class="flex items-center text-sm font-medium gap-1 select-none">
          <input type="checkbox" id="edit-toggle" class="accent-blue-600"> ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
        </label>
      </div>
    </div>

    <!-- ãƒ†ãƒ¬ãƒ“ç”¨ã‚½ãƒ¼ãƒˆ UI -->
    <div id="sort-container" class="mb-6 hidden">
      <label class="text-sm font-semibold mr-2">ä¸¦ã¹æ›¿ãˆ:</label>
      <select id="sort-select" class="border rounded px-2 py-1 text-sm">
        <option value="default">æ—¢å®š</option>
        <option value="isDisplay">å±•ç¤ºå“ â†’ é€šå¸¸å“</option>
        <option value="ã‚µã‚¤ã‚º(ã‚¤ãƒ³ãƒ)">ã‚µã‚¤ã‚ºæ˜‡é †</option>
        <option value="ãƒ¡ãƒ¼ã‚«ãƒ¼">ãƒ¡ãƒ¼ã‚«ãƒ¼Aâ†’Z</option>
      </select>
    </div>

    <div id="filter-container" class="space-y-6 mb-8"></div>
    <h3 id="model-list-title" class="text-xl font-bold mb-4"></h3>
    <div id="model-list" class="grid gap-6"></div>
    <div id="comparison-preview" class="my-8"></div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ç½®ãå ´ -->
  <div id="modal-root"></div>

  <!-- SCRIPT -->
  <script>
    /* ======================
       ãƒ‡ãƒ¼ã‚¿ï¼è¨­å®š
    ====================== */
    const productConfigs={
      tv:{
        title:"ãƒ†ãƒ¬ãƒ“æ¯”è¼ƒ",
        subtitle:"ãƒ†ãƒ¬ãƒ“ã‚’é¸æŠã—ã¦æ¯”è¼ƒ",
        dataUrl:"tv-data.json",
        modelNameKey:"ãƒ¢ãƒ‡ãƒ«å",
        cardFields:[
          {label:"ã‚µã‚¤ã‚º",key:"ã‚µã‚¤ã‚º(ã‚¤ãƒ³ãƒ)",suffix:"ã‚¤ãƒ³ãƒ"},
          {label:"è§£åƒåº¦",key:"è§£åƒåº¦"}
        ],
        filters:[
          {key:"ãƒ¡ãƒ¼ã‚«ãƒ¼",label:"ãƒ¡ãƒ¼ã‚«ãƒ¼"},
          {key:"ã‚µã‚¤ã‚º(ã‚¤ãƒ³ãƒ)",label:"ã‚µã‚¤ã‚º"}
        ],
        specialFlag:"isDisplay" // å±•ç¤ºå“ãƒ•ãƒ©ã‚°
      },
      ac:{
        title:"ã‚¨ã‚¢ã‚³ãƒ³æ¯”è¼ƒ",
        subtitle:"ã‚¨ã‚¢ã‚³ãƒ³ã‚’é¸æŠã—ã¦æ¯”è¼ƒ",
        dataUrl:"ac-data.json",
        modelNameKey:"å‹ç•ª",
        cardFields:[
          {label:"ç•³æ•°",key:"ç•³æ•°"},
          {label:"çœã‚¨ãƒ",key:"çœã‚¨ãƒæ€§èƒ½"}
        ],
        filters:[{key:"ãƒ¡ãƒ¼ã‚«ãƒ¼",label:"ãƒ¡ãƒ¼ã‚«ãƒ¼"}]
      },
      refrigerator:{
        title:"å†·è”µåº«æ¯”è¼ƒ",
        subtitle:"å†·è”µåº«ã‚’é¸æŠã—ã¦æ¯”è¼ƒ",
        dataUrl:"refrigerator-data.json",
        modelNameKey:"å‹ç•ª",
        cardFields:[
          {label:"å®¹é‡",key:"å®šæ ¼å†…å®¹ç©(L)",suffix:"L"},
          {label:"çœã‚¨ãƒ",key:"çœã‚¨ãƒåŸºæº–é”æˆç‡(%)",suffix:"%"}
        ],
        filters:[{key:"ãƒ¡ãƒ¼ã‚«ãƒ¼",label:"ãƒ¡ãƒ¼ã‚«ãƒ¼"}]
      }
    };

    /* ======================
       çŠ¶æ…‹ï¼DOMãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    ====================== */
    const appState={type:null,data:[],selected:[],filters:{},edit:false};
    const $=s=>document.querySelector(s);
    const $$=s=>document.querySelectorAll(s);
    const sid=s=>s.replace(/\s+/g,'_').replace(/[^\w-]/g,'');

    const showSel=()=>{$("#selection-screen").classList.remove("hidden");$("#app-container").classList.add("hidden");};
    const showApp=()=>{$("#selection-screen").classList.add("hidden");$("#app-container").classList.remove("hidden");};

    /* ======================
       èµ·å‹•
    ====================== */
    $("#select-tv").onclick=()=>launch('tv');
    $("#select-ac").onclick=()=>launch('ac');
    $("#select-refrigerator").onclick=()=>launch('refrigerator');
    $("#back-to-selection").onclick=showSel;
    $("#edit-toggle").onchange=e=>{appState.edit=e.target.checked;renderList();};

    async function launch(type){
      appState.type=type;
      appState.selected=[];
      appState.filters={};
      appState.edit=false;
      $("#edit-toggle").checked=false;

      const cfg=productConfigs[type];
      $("#main-title").textContent=cfg.title;
      $("#main-subtitle").textContent=cfg.subtitle;
      $("#sort-container").classList.toggle("hidden",type!=='tv');

      try{
        const res=await fetch(cfg.dataUrl);
        if(!res.ok)throw new Error(res.status);
        const json=await res.json();
        appState.data=json.map((o,i)=>({...o,id:sid(o[cfg.modelNameKey]+i),isDisplay:/å±•ç¤º/.test(o["ãƒ¡ãƒ¼ã‚«ãƒ¼"])||o.isDisplay}));
        renderFilters();
        renderList();
        showApp();
      }catch(err){alert(`ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ (${err}). ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚„JSONæ§‹æ–‡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);}
    }

    /* ======================
       ãƒ•ã‚£ãƒ«ã‚¿ï¼ã‚½ãƒ¼ãƒˆ
    ====================== */
    function renderFilters(){
      const cfg=productConfigs[appState.type];
      const cont=$("#filter-container");
      cont.innerHTML="";
      cfg.filters.forEach(f=>{
        const vals=[...new Set(appState.data.map(d=>d[f.key]).filter(Boolean))].sort((a,b)=>a-b);
        const sec=document.createElement("div");
        sec.innerHTML=`<h4 class='font-bold mb-1 text-sm'>${f.label}</h4>`;
        const wrap=document.createElement("div");
        wrap.className="flex flex-wrap gap-2";
        wrap.appendChild(makeFbtn(f.key,null,"ã™ã¹ã¦"));
        vals.forEach(v=>wrap.appendChild(makeFbtn(f.key,v,v)));
        sec.appendChild(wrap);
        cont.appendChild(sec);
      });
    }

    const makeFbtn=(k,val,lab)=>{
      const b=document.createElement("button");
      b.className="btn bg-gray-200 text-gray-700 px-2 py-0.5 text-xs";
      const active=(val===null)?!(k in appState.filters):appState.filters[k]===val;
      if(active)b.classList.add("btn-primary","text-white");
      b.textContent=lab;
      b.onclick=()=>{if(val===null)delete appState.filters[k];else appState.filters[k]=val;renderFilters();renderList();};
      return b
    }

    $("#sort-select").onchange=()=>renderList();

    /* ======================
       ãƒªã‚¹ãƒˆï¼ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
    ====================== */
    function renderList(){
      const cfg=productConfigs[appState.type];
      let list=[...appState.data];
      // filter
      Object.entries(appState.filters).forEach(([k,v])=>list=list.filter(d=>d[k]===v));
      // sort for TV
      if(appState.type==='tv'){
        const key=$("#sort-select").value;
        if(key!=='default'){
          list.sort((a,b)=>{
            if(key==='isDisplay')return(a.isDisplay===b.isDisplay)?0:(a.isDisplay?-1:1);
            if(typeof a[key]==='number')return a[key]-b[key];
            return String(a[key]).localeCompare(String(b[key]));
          })
        }
      }
      const wrap=$("#model-list");
      wrap.className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6";
      wrap.innerHTML=list.map(m=>makeCard(m,cfg)).join("");

      // attach events
      $$("#model-list .card").forEach(card=>card.onclick=e=>{
        // avoid event if inside button
        if(e.target.closest('button'))return;
        const m=list.find(x=>x.id===card.dataset.id);
        detailModal(m,cfg);
      });
      $$("#model-list .google-btn").forEach(btn=>btn.onclick=e=>{
        e.stopPropagation();
        window.open(`https://www.google.com/search?q=${encodeURIComponent(btn.dataset.q)}`,'_blank');
      });
      $$("#model-list .gemini-btn").forEach(btn=>btn.onclick=e=>{
        e.stopPropagation();
        askGemini(btn.dataset.q);
      });
      $$("#model-list .edit-btn").forEach(btn=>btn.onclick=e=>{
        e.stopPropagation();
        const m=list.find(x=>x.id===btn.dataset.id);
        editModal(m);
      })
    }

    function makeCard(m,cfg){
      const sel=appState.selected.includes(m.id);
      const flag=cfg.specialFlag&&(m[cfg.specialFlag]||m.isDisplay);
      return `<div class="card p-4 flex flex-col gap-2" data-id="${m.id}">
        <div class="flex justify-between items-start">
          <h4 class="font-bold">${m[cfg.modelNameKey]}</h4>
          ${flag?'<span class="text-xs px-2 py-0.5 bg-yellow-400 rounded">å±•ç¤ºå“</span>':''}
        </div>
        <div class="text-sm space-y-1 mb-2">
          ${cfg.cardFields.map(f=>`<p><span class="font-medium">${f.label}:</span> ${m[f.key]}${f.suffix||''}</p>`).join('')}
        </div>
        <div class="mt-auto flex gap-2 text-xs">
          <button class="btn btn-primary flex-1 select-btn" data-id="${m.id}" ${sel?'disabled':''}>${sel?'é¸æŠä¸­':'é¸æŠ'}</button>
          <button class="btn btn-secondary google-btn" data-q="${m[cfg.modelNameKey]}">Google</button>
          <button class="btn btn-tertiary gemini-btn" data-q="${m[cfg.modelNameKey]}">Gemini</button>
          ${appState.edit?`<button class="btn btn-danger edit-btn" data-id="${m.id}">ç·¨é›†</button>`:''}
        </div>
      </div>`
    }

    // é¸æŠåˆ‡æ›¿
    function toggleSelect(e){
      const id=e.target.dataset.id;
      if(appState.selected.includes(id))appState.selected=appState.selected.filter(x=>x!==id);else appState.selected.push(id);
      renderList();
    }

    /* ======================
       è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«
    ====================== */
    function detailModal(m,cfg){
      const root=$("#modal-root");
      root.innerHTML=`<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50" id="modal-overlay">
        <div class="bg-white rounded-2xl max-w-lg w-full p-6 relative animate-fade-in">
          <button class="absolute top-3 right-3 text-xl" id="modal-close">Ã—</button>
          <h3 class="text-2xl font-bold mb-4">${m[cfg.modelNameKey]}</h3>
          <div class="space-y-1 text-sm">
            ${Object.entries(m).filter(([k,v])=>k!=='id').map(([k,v])=>`<p><span class="font-medium">${k}</span>: ${v}</p>`).join('')}
          </div>
        </div>
      </div>`;
      $("#modal-close").onclick=$("#modal-overlay").onclick=e=>{if(e.target.id==='modal-overlay'||e.target.id==='modal-close')root.innerHTML=''};
    }

    /* ======================
       ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«
    ====================== */
    function editModal(m){
      const root=$("#modal-root");
      const pre=JSON.stringify(m,null,2);
      root.innerHTML=`<div class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50" id="modal-overlay">
        <div class="bg-white rounded-2xl w-full max-w-2xl p-6 relative animate-fade-in flex flex-col gap-4">
          <button class="absolute top-3 right-3 text-xl" id="modal-close">Ã—</button>
          <h3 class="text-xl font-bold">JSON ç·¨é›† â€“ ${m.id}</h3>
          <textarea id="json-edit" class="border p-2 flex-1 text-xs font-mono rounded h-96">${pre}</textarea>
          <div class="flex justify-end gap-2 text-sm">
            <button class="btn btn-secondary" id="cancel-edit">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button class="btn btn-primary" id="save-edit">ä¿å­˜</button>
          </div>
        </div>
      </div>`;
      $("#cancel-edit").onclick=$("#modal-close").onclick=e=>{root.innerHTML=''};
      $("#save-edit").onclick=()=>{
        try{
          const obj=JSON.parse($("#json-edit").value);
          // ensure id stays the same
          obj.id=m.id;
          const idx=appState.data.findIndex(x=>x.id===m.id);
          if(idx!==-1)appState.data[idx]=obj;
          localStorage.setItem(`sloth_${appState.type}_data`,JSON.stringify(appState.data)); // optional persist
          root.innerHTML='';
          renderList();
        }catch(err){alert('JSON æ§‹æ–‡ã‚¨ãƒ©ãƒ¼: '+err)}
      }
    }

    /* ======================
       Gemini å‘¼ã³å‡ºã—ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰
    ====================== */
    function askGemini(q){
      // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ‡ãƒ«ã«å·®ã—æ›¿ãˆã‚‹å ´åˆã¯ã“ã“ã§å‘¼ã³å‡ºã—å‡¦ç†ã‚’æ›¸ãæ›ãˆã‚‹ã ã‘ã§OKã§ã™
      alert(`"${q}" ã«ã¤ã„ã¦ Gemini ã«è³ªå•ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ (ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ‡ãƒ«ã«ã‚‚ç½®ãæ›ãˆå¯)`);
    }

    /* ======================
       åˆæœŸåŒ–ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿å„ªå…ˆ
    ====================== */
    window.addEventListener('load',()=>{
      ['tv','ac','refrigerator'].forEach(t=>{
        const saved=localStorage.getItem(`sloth_${t}_data`);
        if(saved)try{const d=JSON.parse(saved);if(Array.isArray(d)&&d.length)console.log(`${t} data loaded from LS`)}catch{}}
      );
    });
  </script>
</body>
</html>
